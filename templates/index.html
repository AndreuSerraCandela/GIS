<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GIS Web App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
    <div class="container">
        <header>
            <h1>üó∫Ô∏è Sistema de Informaci√≥n Geogr√°fica</h1>
            <p>Aplicaci√≥n web para visualizaci√≥n de datos geoespaciales</p>
        </header>
        
        <main>
            <div class="map-container">
                <div id="map"></div>
            </div>
            
            <div class="controls">
                <h3>Controles de Datos</h3>
                <button id="loadAllData" class="btn btn-primary">Cargar Todos los Datos</button>
                <button id="loadRecursos" class="btn btn-success">Cargar Recursos</button>
                <button id="loadMobiliario" class="btn btn-info">Cargar Mobiliario</button>
                <button id="clearMap" class="btn btn-secondary">Limpiar Mapa</button>
                <div id="status" class="status"></div>
                
                <!-- Nueva secci√≥n de b√∫squeda -->
                <div class="search-section">
                    <h3>üîç Buscar Recursos Cerca</h3>
                    <div class="search-controls">
                        <div class="search-option">
                            <label>
                                <input type="radio" name="searchType" value="place" checked>
                                <span>De un tipo de lugar</span>
                            </label>
                        </div>
                        <div class="search-option">
                            <label>
                                <input type="radio" name="searchType" value="coordinates">
                                <span>De coordenadas espec√≠ficas</span>
                            </label>
                        </div>
                        <div class="search-option">
                            <label>
                                <input type="radio" name="searchType" value="address">
                                <span>De una direcci√≥n</span>
                            </label>
                        </div>
                        <div class="search-option">
                            <label>
                                <input type="radio" name="searchType" value="zone">
                                <span>De una zona personalizada</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- B√∫squeda por tipo de lugar -->
                    <div id="placeSearch" class="search-panel active">
                        <div class="form-group">
                            <label for="placeType">Tipo de lugar:</label>
                            <select id="placeType" class="form-control">
                                <option value="">Seleccionar tipo...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="placeRadius">Radio de b√∫squeda (km) *:</label>
                            <input type="number" id="placeRadius" class="form-control" value="5" min="0.1" max="50" step="0.1" required>
                            <small class="form-text text-muted">Obligatorio: entre 0.1 y 50 km</small>
                        </div>
                        <button id="searchByPlace" class="btn btn-warning">Buscar Recursos Cerca</button>
                        <button id="useSavedLocationPlace" class="btn btn-info" title="No hay ubicaci√≥n guardada. Usa 'Obtener Ubicaci√≥n Actual' primero.">üìç¬øDonde Buscar?</button>
                        <button id="cancelSearch" class="btn btn-secondary" style="display: none;">Cancelar B√∫squeda</button>
                    </div>
                    
                    <!-- B√∫squeda por coordenadas -->
                    <div id="coordinatesSearch" class="search-panel">
                        <div class="form-group">
                            <label for="coordLat">Latitud:</label>
                            <input type="number" id="coordLat" class="form-control" step="any" placeholder="39.5696">
                        </div>
                        <div class="form-group">
                            <label for="coordLon">Longitud:</label>
                            <input type="number" id="coordLon" class="form-control" step="any" placeholder="2.6502">
                        </div>
                        <div class="form-group">
                            <label for="coordRadius">Radio de b√∫squeda (km) *:</label>
                            <input type="number" id="coordRadius" class="form-control" value="5" min="0.1" max="50" step="0.1" required>
                            <small class="form-text text-muted">Obligatorio: entre 0.1 y 50 km</small>
                        </div>
                        <div class="form-group">
                            <button type="button" class="btn btn-info btn-sm" onclick="selectCoordinatesFromMap()">üìç Seleccionar en el Mapa</button>
                            <button type="button" class="btn btn-secondary btn-sm" onclick="clearCoordinates()">Limpiar</button>
                        </div>
                        <button id="searchByCoordinates" class="btn btn-warning">Buscar Recursos Cerca</button>
                        <button id="useCurrentLocation" class="btn btn-info" title="Obtener tu ubicaci√≥n actual usando GPS">üìç Obtener Ubicaci√≥n Actual</button>
                        <div id="locationStatus" class="location-status" style="display: none; margin-top: 5px; padding: 5px; background-color: #e8f5e8; border: 1px solid #4caf50; border-radius: 3px; font-size: 12px; color: #2e7d32;">
                            <span id="locationStatusText">üìç Ubicaci√≥n guardada disponible</span>
                        </div>
                    </div>
                    
                    <!-- B√∫squeda por direcci√≥n -->
                    <div id="addressSearch" class="search-panel">
                        <div class="form-group">
                            <label for="addressInput">Direcci√≥n:</label>
                            <input type="text" id="addressInput" class="form-control" placeholder="Plaza Espa√±a, Palma">
                        </div>
                        <div class="form-group">
                            <label for="addressRadius">Radio de b√∫squeda (km) *:</label>
                            <input type="number" id="addressRadius" class="form-control" value="5" min="0.1" max="50" step="0.1" required>
                            <small class="form-text text-muted">Obligatorio: entre 0.1 y 50 km</small>
                        </div>
                        <button id="searchByAddress" class="btn btn-warning">Buscar Recursos Cerca</button>
                        <button id="useSavedLocationAddress" class="btn btn-info" title="No hay ubicaci√≥n guardada. Usa 'Obtener Ubicaci√≥n Actual' primero.">üìç ¬øDonde Buscar?</button>
                    </div>
                    
                    <!-- B√∫squeda por zona personalizada -->
                    <div id="zoneSearch" class="search-panel">
                        <div class="form-group">
                            <label for="zoneSelect">Zona personalizada:</label>
                            <select id="zoneSelect" class="form-control">
                                <option value="">Seleccionar zona...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button id="createNewZone" class="btn btn-success btn-sm">‚ûï Crear Nueva Zona</button>
                            <button id="editZone" class="btn btn-warning btn-sm" disabled>‚úèÔ∏è Editar Zona</button>
                            <button id="deleteZone" class="btn btn-danger btn-sm" disabled>üóëÔ∏è Eliminar Zona</button>
                        </div>
                        <div class="form-group">
                            <label for="zoneRadius">Radio de b√∫squeda (km) *:</label>
                            <input type="number" id="zoneRadius" class="form-control" value="5" min="0.1" max="50" step="0.1" required>
                            <small class="form-text text-muted">Obligatorio: entre 0.1 y 50 km</small>
                        </div>
                        <button id="searchByZone" class="btn btn-warning">Buscar Recursos en Zona</button>
                        <button id="useSavedLocationZone" class="btn btn-info" title="No hay ubicaci√≥n guardada. Usa 'Obtener Ubicaci√≥n Actual' primero.">üìç ¬øDonde Buscar?</button>
                    </div>
                    
                    <div class="search-instructions">
                        <p><strong>üí° Instrucciones:</strong></p>
                        <ul>
                            <li><strong>Tipo de lugar:</strong> Selecciona el tipo y haz clic en el mapa para buscar</li>
                            <li><strong>Coordenadas:</strong> Introduce coordenadas manualmente, haz clic en el mapa o usa tu ubicaci√≥n actual</li>
                            <li><strong>Ubicaci√≥n actual:</strong> La primera vez obt√©n tu ubicaci√≥n GPS, despu√©s podr√°s reutilizarla f√°cilmente</li>
                            <li><strong>Direcci√≥n:</strong> Escribe una direcci√≥n y busca recursos cerca</li>
                            <li><strong>Zona personalizada:</strong> Crea zonas dibujando en el mapa y gu√°rdalas para b√∫squedas futuras</li>
                            <li><strong>Radio obligatorio:</strong> Siempre debes especificar el radio de b√∫squeda (0.1-50 km)</li>
                            <li><strong>Posicionamiento:</strong> Para b√∫squedas por tipo de lugar, haz clic en el mapa donde quieres buscar</li>
                        </ul>
                    </div>
                </div>
                
                <div class="legend">
                    <h4>Leyenda</h4>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #44ff44;"></div>
                        <span>Recursos sin problemas</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #ff8800;"></div>
                        <span>Recursos con campa√±as</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #ff4444;"></div>
                        <span>Recursos con incidencias</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-icon" style="background-color: #4488ff; color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">üöå</div>
                        <span>Mobiliario sin incidencias</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-icon" style="background-color: #ff8800; color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">üöå</div>
                        <span>Mobiliario con incidencias</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-icon" style="background-color: #9c27b0; color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">üìç</div>
                        <span>Lugares encontrados</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-icon" style="background-color: #ff5722; color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">üéØ</div>
                        <span>Punto de b√∫squeda</span>
                    </div>
                </div>
            </div>
        </main>
        
        <footer>
            <p>&copy; 2025 - Proyecto GIS Web App</p>
        </footer>
    </div>
    
    <!-- Modal para crear/editar zonas -->
    <div id="zoneModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="zoneModalTitle">Crear Nueva Zona</h3>
                <span class="close" id="closeZoneModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="zoneName">Nombre de la zona:</label>
                    <input type="text" id="zoneName" class="form-control" placeholder="Ej: Centro de Palma, Zona Norte, etc.">
                </div>
                <div class="form-group">
                    <label for="zoneDescription">Descripci√≥n (opcional):</label>
                    <textarea id="zoneDescription" class="form-control" rows="3" placeholder="Describe la zona o a√±ade notas..."></textarea>
                </div>
                <div class="form-group">
                    <label>Dibujar zona en el mapa:</label>
                    <div class="zone-instructions">
                        <p><strong>Instrucciones:</strong></p>
                        <ul>
                            <li>Haz clic en "Iniciar Dibujo" para comenzar a dibujar</li>
                            <li>Haz clic en el mapa para crear puntos de la zona</li>
                            <li>Haz doble clic para finalizar el dibujo</li>
                            <li>Puedes crear zonas rectangulares o poligonales</li>
                        </ul>
                    </div>
                    <div class="zone-controls">
                        <button id="startDrawing" class="btn btn-primary">üé® Iniciar Dibujo</button>
                        <button id="finishDrawing" class="btn btn-success" disabled>‚úÖ Finalizar Dibujo</button>
                        <button id="clearDrawing" class="btn btn-warning" disabled>üóëÔ∏è Limpiar</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Tipo de zona:</label>
                    <div class="zone-type-options">
                        <label>
                            <input type="radio" name="zoneType" value="rectangle" checked>
                            <span>Rectangular</span>
                        </label>
                        <label>
                            <input type="radio" name="zoneType" value="polygon">
                            <span>Poligonal</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveZone" class="btn btn-success" disabled>üíæ Guardar Zona</button>
                <button id="cancelZone" class="btn btn-secondary">‚ùå Cancelar</button>
            </div>
        </div>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
